<div class="p-4">
  <h3>Initiaza sesiune</h3>
  <form [formGroup]="sessionForm" (ngSubmit)="onSubmit()">
    <!-- Optiuni semnare -->
    <div class="mb-4">
      <label class="form-label">Optiuni semnare</label>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="signingOption" id="noElectronicSign" value="noElectronicSign" formControlName="signingOption">
        <label class="form-check-label" for="noElectronicSign">
          Nu se semneaza electronic
        </label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="signingOption" id="digitalSign" value="digitalSign" formControlName="signingOption">
        <label class="form-check-label" for="digitalSign">
          Se semneaza digital
        </label>
      </div>
    </div>

    <div class="row">
      <!-- Instruire -->
      <div class="col-md-4 mb-3">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <label for="instruire" class="form-label mb-0">Instruire</label>
          <div class="btn-group" role="group">
            <button type="button" class="btn btn-sm btn-success" (click)="openAddModal()">
              <i class="bi bi-plus-circle me-1"></i>Add
            </button>
            <button type="button" class="btn btn-sm btn-danger" (click)="removeSelectedTraining()" [disabled]="!sessionForm.get('instruire')?.value">
              <i class="bi bi-trash me-1"></i>Remove
            </button>
          </div>
        </div>
        <select class="form-select training-listbox" id="instruire" formControlName="instruire" [attr.size]="trainings.length > 5 ? 5 : trainings.length">
          <option *ngFor="let training of trainings" [value]="training.id">{{ training.name }}</option>
        </select>
      </div>

      <!-- Selecteaza COR -->
      <div class="col-md-4 mb-3">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <label for="tipInitiere" class="form-label mb-0">Selecteaza COR</label>
          <button type="button" class="btn btn-sm btn-primary" (click)="saveCOR()">
            <i class="bi bi-save me-1"></i>Save
          </button>
        </div>
        <select class="form-select" id="tipInitiere" formControlName="tipInitiere">
          <option selected>Selecteaza</option>
          <option value="selecteaza">Selecteaza</option>
        </select>
      </div>

      <!-- Perioada de valabilitate a sesiunii & Termen limita -->
      <div class="col-md-4 mb-3">
        <label for="dataInceput" class="form-label">Perioada de valabilitate a sesiunii</label>
        <input type="datetime-local" class="form-control mb-3" id="dataInceput" formControlName="dataInceput">
        
        <label for="termenLimita" class="form-label">Termen limita</label>
        <input type="date" class="form-control" id="termenLimita" formControlName="termenLimita">
      </div>
    </div>

    <div class="row">
      <!-- Selecteaza de aici angajatii -->
      <div class="col-md-8 mb-3">
        <div class="border rounded p-3">
          <button type="button" class="btn btn-link p-0 mb-2">{{ filteredEmployeesCount }} filtrati</button>
          <div class="mb-2">
            <label for="angajatiSelectati" class="form-label">* Sesiuni COR salvate</label>
            <select class="form-select" id="angajatiSelectati" formControlName="angajatiSelectati" size="3" multiple>
              <option *ngFor="let employee of sessionForm.get('angajatiSelectati')?.value" [value]="employee">
                {{ employee }}
              </option>
            </select>
            <div class="text-muted mt-1 small">{{ selectedEmployeesCount }} selectati</div>
          </div>
        </div>
      </div>

      <!-- Setari -->
      <div class="col-md-4 mb-3">
        <label class="form-label">Setari</label>
        <div class="form-check">
          <input class="form-check-input" type="radio" name="tipSesiune" id="sesiuneAngajare" value="angajare" formControlName="tipSesiune">
          <label class="form-check-label" for="sesiuneAngajare">
            Sesiune angajare
          </label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="radio" name="tipSesiune" id="sesiunePeriodica" value="periodica" formControlName="tipSesiune">
          <label class="form-check-label" for="sesiunePeriodica">
            Sesiune periodica
          </label>
        </div>
      </div>
    </div>

    <div class="text-end">
      <button type="submit" class="btn btn-primary btn-lg" (click)="onSubmit()">Initiaza sesiune</button>
    </div>
  </form>
</div>

<!-- Add Training Modal -->
<div class="modal fade" [class.show]="showAddModal" [style.display]="showAddModal ? 'block' : 'none'" tabindex="-1" *ngIf="showAddModal">
  <div class="modal-backdrop fade" [class.show]="showAddModal" (click)="closeAddModal()"></div>
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Select Training</h5>
        <button type="button" class="btn-close" (click)="closeAddModal()"></button>
      </div>
      <div class="modal-body">
        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th style="width: 80px;">ID</th>
                <th>Name</th>
                <th>Type</th>
                <th style="width: 100px;">Language</th>
                <th style="width: 100px;" class="text-center">Action</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let training of availableTrainings" 
                  [class.table-active]="selectedTrainingId === training.id"
                  (click)="selectTraining(training.id)"
                  style="cursor: pointer;">
                <td>{{ training.id }}</td>
                <td>{{ training.name }}</td>
                <td>{{ training.type }}</td>
                <td>{{ training.language }}</td>
                <td class="text-center">
                  <i class="bi bi-check-circle-fill text-success" *ngIf="selectedTrainingId === training.id"></i>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeAddModal()">Cancel</button>
        <button type="button" class="btn btn-success" (click)="addSelectedTraining()" [disabled]="selectedTrainingId === null">
          <i class="bi bi-plus-circle me-1"></i>Add Selected
        </button>
      </div>
    </div>
  </div>
</div>
